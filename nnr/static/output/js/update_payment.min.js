function getPublicKey(){return fetch("/main/public_key/",{method:"get",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(e){console.log(e),stripeElements(e.publicKey)}))}getPublicKey();var stripe,dotter,success_url="/accounts/thankyou/",stripeElements=function(e){var t=(stripe=Stripe(e)).elements().create("card",{style:{base:{fontSize:"16px",color:"#32325d",fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif",fontSmoothing:"antialiased","::placeholder":{color:"rgba(0,0,0,0.4)"}}}});t.mount("#card-element"),t.addEventListener("change",(function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""})),document.getElementById("update_payment").addEventListener("submit",(function(e){e.preventDefault(),changeLoadingState(!0),stripe.createPaymentMethod({type:"card",card:t}).then((function(e){e.error?showCardError(e.error):(console.log("Got result"),console.log(e),updatePaymentMethod(e.paymentMethod.id))}))}))};async function updatePaymentMethod(e){let t=document.getElementById("update_payment"),n=document.getElementsByName("csrfmiddlewaretoken")[0].value,o={payment_method:e};console.log("sending data"),console.log(o),fetch(t.action,{method:"post",headers:{"Content-Type":"application/json","X-CSRFToken":n,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(o)}).then((e=>(console.log("returning response JSON"),e.json()))).then((e=>{if(console.log(e),e.error)showCardError(e.error);else{changeLoadingState(!1);const t=createAlert(e.message,["alert-success"]);document.getElementById("update_payment_header").after(t),cardInfo=document.getElementById("card_info"),cardInfo.textContent=e.newPay}}))}function showCardError(e){changeLoadingState(!1);const t=createAlert(e.message,["alert-danger"]);document.getElementById("update_payment_header").after(t)}var changeLoadingState=function(e){if(form=document.getElementById("update_payment"),e){let e=document.createElement("div");e.id="loading_message",form.before(e),form.hidden=!0,e.textContent="Loading",dotter=setInterval((function(){e.textContent=e.textContent+"."}),3e3)}else clearInterval(dotter),msg=document.getElementById("loading_message"),msg.remove(),document.getElementById("update_payment").hidden=!1};