for(untagForm of document.getElementsByClassName("untag-form"))untagForm.addEventListener("submit",(function(e){e.preventDefault(),untag(this)}));async function untag(e){const t={recipe:parseInt(e.recipe.value),tag_slug:e.tag_slug.value};fetch(e.action,{method:"post",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfmiddlewaretoken.value,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{if(t.error){const a=createAlert(t.error,["alert-danger"]);$(`#untag_${e.tag_slug.value}`).modal("hide"),document.getElementById("tag-container").before(a)}else{const a=createAlert(t.message,["alert-success"]);$(`#untag_${e.tag_slug.value}`).modal("hide"),document.getElementById("tag-container").before(a),document.getElementById(`untag-container_${e.tag_slug.value}`).remove()}}))}async function get_all_tags(){fetch("/tags/all/",{method:"get",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then((e=>e.json())).then((e=>{if(e.error){const t=createAlert(e.error,["alert-danger"]);document.getElementById("id_tags").before(t)}else tag_list=e.tag_list,autocomplete(document.getElementById("id_tags"),e.tag_list)}))}function search_for_autocomplete(e,t){return res=t.filter((t=>t.toLowerCase().search(e.toLowerCase())>-1)).sort((t=>t.toLowerCase().search(e.toLowerCase()))),res}function autocomplete(e,t){var a;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),a>=e.length&&(a=0),a<0&&(a=e.length-1),e[a].classList.add("autocomplete-active")}function o(t){for(var a=document.getElementsByClassName("autocomplete-items"),n=0;n<a.length;n++)t!=a[n]&&t!=e&&a[n].parentNode.removeChild(a[n])}e.addEventListener("input",(function(s){var l,i,r;if(lastComma=this.value.lastIndexOf(","),r=lastComma>-1?this.value.slice(lastComma+1).trim():this.value,o(),!r)return!1;a=-1;let c=search_for_autocomplete(r,t);(l=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),l.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(l),c.map((t=>{i=document.createElement("div");let a=new RegExp(r,"gi");res=t.replace(a,(e=>`<strong>${e}</strong>`)),i.innerHTML=res,i.innerHTML+=`<input type='hidden' value='${t}'>`,i.addEventListener("click",(function(t){selected=this.getElementsByTagName("input")[0].value,lastComma=e.value.lastIndexOf(","),-1===lastComma?e.value=selected:e.value=e.value.slice(0,lastComma)+`, ${selected}`,o()})),l.appendChild(i)})),x=document.getElementById(this.id+"autocomplete-list"),x&&(ac_list=x.getElementsByTagName("div"),a=0,n(ac_list))})),e.addEventListener("keydown",(function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40===e.keyCode?(a++,n(t)):38===e.keyCode?(a--,n(t)):13===e.keyCode||9===e.keyCode?(e.preventDefault(),a>-1&&t&&t[a].click()):188===e.keyCode&&o()})),document.addEventListener("click",(function(e){o(e.target)}))}get_all_tags();