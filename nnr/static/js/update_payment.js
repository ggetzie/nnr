"use strict";function asyncGeneratorStep(e,t,n,o,r,a,c){try{var d=e[a](c),s=d.value}catch(e){return void n(e)}d.done?t(s):Promise.resolve(s).then(o,r)}function _asyncToGenerator(d){return function(){var e=this,c=arguments;return new Promise(function(t,n){var o=d.apply(e,c);function r(e){asyncGeneratorStep(o,t,n,r,a,"next",e)}function a(e){asyncGeneratorStep(o,t,n,r,a,"throw",e)}r(void 0)})}}function getPublicKey(){return fetch("/main/public_key/",{method:"get",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){console.log(e),stripeElements(e.publicKey)})}getPublicKey();var stripe,dotter,success_url="/accounts/thankyou/",stripeElements=function(e){var t=(stripe=Stripe(e)).elements().create("card",{style:{base:{fontSize:"16px",color:"#32325d",fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif",fontSmoothing:"antialiased","::placeholder":{color:"rgba(0,0,0,0.4)"}}}});t.mount("#card-element"),t.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""}),document.getElementById("update_payment").addEventListener("submit",function(e){e.preventDefault(),changeLoadingState(!0),stripe.createPaymentMethod({type:"card",card:t}).then(function(e){e.error?showCardError(e.error):(console.log("Got result"),console.log(e),updatePaymentMethod(e.paymentMethod.id))})})};function updatePaymentMethod(e){return _updatePaymentMethod.apply(this,arguments)}function _updatePaymentMethod(){return(_updatePaymentMethod=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("update_payment"),o=document.getElementsByName("csrfmiddlewaretoken")[0].value,r={payment_method:t},console.log("sending data"),console.log(r),fetch(n.action,{method:"post",headers:{"Content-Type":"application/json","X-CSRFToken":o,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)}).then(function(e){return console.log("returning response JSON"),e.json()}).then(function(e){var t;console.log(e),e.error?showCardError(e.error):(changeLoadingState(!1),t=createAlert(e.message,["alert-success"]),document.getElementById("update_payment_header").after(t),cardInfo=document.getElementById("card_info"),cardInfo.textContent=e.newPay)});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function showCardError(e){changeLoadingState(!1);var t=createAlert(e.message,["alert-danger"]);document.getElementById("update_payment_header").after(t)}var changeLoadingState=function(e){var t;form=document.getElementById("update_payment"),e?((t=document.createElement("div")).id="loading_message",form.before(t),form.hidden=!0,t.textContent="Loading",dotter=setInterval(function(){t.textContent=t.textContent+"."},3e3)):(clearInterval(dotter),msg=document.getElementById("loading_message"),msg.remove(),document.getElementById("update_payment").hidden=!1)};